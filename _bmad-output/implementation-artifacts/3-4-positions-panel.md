# Story 3.4: Positions Panel

Status: ready-for-dev

## Story

As a player,
I want to see my current positions with real-time P&L in a sidebar,
so that I can manage my trades and know what I'm holding.

## Acceptance Criteria

1. Right sidebar displays all open positions (long and short)
2. Each position shows: ticker symbol, shares held, average buy/entry price, current unrealized P&L
3. Short positions are visually distinct from long positions (hot pink vs green)
4. Positions update in real-time as prices change
5. Panel is empty when no positions are held (shows "No positions" or similar)
6. Closing a position (sell/cover) removes it from the panel immediately

## Tasks / Subtasks

- [ ] Task 1: Create PositionPanel MonoBehaviour (AC: 1, 4)
  - [ ] Subscribe to `PriceUpdatedEvent` to refresh P&L values
  - [ ] Subscribe to `TradeExecutedEvent` to add/remove position entries
  - [ ] Read position data from `RunContext.Portfolio.GetAllPositions()`
  - [ ] File: `Scripts/Runtime/UI/PositionPanel.cs`
- [ ] Task 2: Build position entry UI elements (AC: 2)
  - [ ] Per-entry layout: ticker (left), shares count, avg price, P&L (right-aligned, colored)
  - [ ] P&L format: "+$12.50" green or "-$8.30" red, monospace font
  - [ ] Compact layout — each entry is a single row or two-line block
  - [ ] File: `Scripts/Runtime/UI/PositionPanel.cs`
- [ ] Task 3: Distinguish long vs short positions (AC: 3)
  - [ ] Long positions: green text/accent color, "LONG" label or no label (default)
  - [ ] Short positions: hot pink text/accent color, "SHORT" label
  - [ ] Optional: small icon or background tint to differentiate at a glance
  - [ ] File: `Scripts/Runtime/UI/PositionPanel.cs`
- [ ] Task 4: Handle empty state and position changes (AC: 5, 6)
  - [ ] Show "No open positions" text when portfolio has no positions
  - [ ] On `TradeExecutedEvent` with isBuy=true: add entry or update existing
  - [ ] On `TradeExecutedEvent` with isSell=true: update or remove entry
  - [ ] Animate entry removal (brief fade or slide out) if simple to implement
  - [ ] File: `Scripts/Runtime/UI/PositionPanel.cs`
- [ ] Task 5: Add positions panel to UISetup (AC: 1)
  - [ ] Generate panel Canvas elements on right side of screen
  - [ ] Vertical layout group for position entries
  - [ ] Position does not overlap chart area
  - [ ] File: `Scripts/Setup/UISetup.cs` (extend)

## Dev Notes

### Architecture Compliance

- **Location:** `Scripts/Runtime/UI/PositionPanel.cs` per architecture project structure
- **One-way read:** Reads from Portfolio. Never modifies positions — that's TradeExecutor's job.
- **EventBus:** Subscribes to `PriceUpdatedEvent` and `TradeExecutedEvent`
- **Setup Framework:** Generated by UISetup.cs

### Color Reference (GDD Section 7.1)

- Long position P&L positive: neon green
- Long position P&L negative: hot pink / red
- Short position accent: hot pink (distinct from long)
- Short position P&L positive: neon green (profit is profit regardless of direction)
- Short position P&L negative: red
- Background: semi-transparent dark overlay on right sidebar

### Position Entry Layout

```
┌────────────────────────┐
│ MEME  10 shares  LONG  │
│ Avg: $2.50  P&L: +$5.00│
├────────────────────────┤
│ YOLO  5 shares   SHORT │
│ Avg: $1.20  P&L: -$1.50│
├────────────────────────┤
│ PUMP  20 shares  LONG  │
│ Avg: $0.45  P&L: +$2.00│
└────────────────────────┘
```

### Interaction Note

The positions panel is read-only display for this story. Clicking a position entry to sell/cover is a potential future enhancement but not required — trades are executed via the main BUY/SELL/SHORT buttons or keyboard shortcuts targeting the currently selected stock.

### Project Structure Notes

- Creates: `Scripts/Runtime/UI/PositionPanel.cs`
- Modifies: `Scripts/Setup/UISetup.cs` (add panel generation)
- Depends on: Portfolio (Epic 2), PriceUpdatedEvent (Epic 1), TradeExecutedEvent (Epic 2)

### References

- [Source: game-architecture.md#Project Structure] — UI/PositionPanel.cs location
- [Source: game-architecture.md#Architectural Boundaries] — "UI classes read from runtime systems (one-way dependency)"
- [Source: bull-run-gdd-mvp.md#6.1] — "Right Sidebar: Current positions. Each held stock shows: shares held, average buy price, current P&L. Short positions shown in a distinct color (hot pink vs. green)."
- [Source: bull-run-gdd-mvp.md#7.1] — Color palette: neon green gains, hot pink losses

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
