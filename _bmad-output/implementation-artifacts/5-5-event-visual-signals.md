# Story 5.5: Event Visual Signals

Status: ready-for-dev

## Story

As a player,
I want clear visual signals when events occur,
so that I can react quickly under time pressure and learn to recognize event patterns.

## Acceptance Criteria

1. Earnings Beat/Miss: colored news banner flash (green for beat, red for miss) across the top of the chart
2. Pump & Dump: suspicious volume spike indicator on the affected stock in the sidebar
3. SEC Investigation: warning icon appears on the affected stock in the sidebar
4. Sector Rotation: sector highlight shift — winning sector stocks glow green, losing glow red
5. Market Crash: screen shake effect + alarm visual (red border pulse)
6. Short Squeeze: warning indicator on the player's short positions in the positions panel
7. News ticker crawl in the bottom bar shows event-related headlines as events fire
8. All signals appear within the same frame the event fires — no delay

## Tasks / Subtasks

- [ ] Task 1: Create NewsTicker UI component (AC: 7)
  - [ ] Horizontal scrolling text in the bottom bar
  - [ ] When an event fires, inject a headline into the ticker queue
  - [ ] Headlines defined per event type in a data class
  - [ ] Multiple headlines can queue and scroll sequentially
  - [ ] Subscribe to `MarketEventFiredEvent`
  - [ ] File: `Scripts/Runtime/UI/NewsTicker.cs`
- [ ] Task 2: Create EventSignalManager to coordinate visual signals (AC: 8)
  - [ ] Subscribe to `MarketEventFiredEvent`
  - [ ] Dispatch to appropriate visual handler based on event type
  - [ ] Ensure signals trigger on the same frame as the event
  - [ ] File: `Scripts/Runtime/UI/EventSignalManager.cs` (new)
- [ ] Task 3: Implement banner flash signals (AC: 1)
  - [ ] Green banner: slides down from top, displays "EARNINGS BEAT — [TICKER]", fades after 2s
  - [ ] Red banner: same but red for earnings miss
  - [ ] Banner appears over the chart area, semi-transparent
  - [ ] File: `Scripts/Runtime/UI/EventSignalManager.cs`
- [ ] Task 4: Implement sidebar stock indicators (AC: 2, 3, 6)
  - [ ] StockSidebar entries gain an icon slot for event indicators
  - [ ] Pump & Dump: pulsing volume bar icon on affected stock
  - [ ] SEC Investigation: yellow warning triangle icon
  - [ ] Short Squeeze: red exclamation icon on affected stock + positions panel warning
  - [ ] Icons appear when event starts, fade when event ends
  - [ ] File: `Scripts/Runtime/UI/StockSidebar.cs` (extend from Story 3.3)
- [ ] Task 5: Implement screen shake for Market Crash (AC: 5)
  - [ ] Camera or Canvas shake effect for 1-2 seconds
  - [ ] Red border pulse (vignette) overlaid on screen
  - [ ] Intensity proportional to crash severity
  - [ ] Use URP post-processing vignette or a simple UI overlay
  - [ ] File: `Scripts/Runtime/UI/ScreenEffects.cs` (new)
- [ ] Task 6: Implement sector highlight for Sector Rotation (AC: 4)
  - [ ] Sidebar entries for winning sector: green glow/border
  - [ ] Sidebar entries for losing sector: red glow/border
  - [ ] Highlight persists for event duration
  - [ ] File: `Scripts/Runtime/UI/StockSidebar.cs` (extend)
- [ ] Task 7: Create event headline data (AC: 7)
  - [ ] 2-3 headline templates per event type
  - [ ] Template: "[TICKER] beats earnings expectations!" / "Flash crash hits [TICKER]!"
  - [ ] Replace [TICKER] with actual stock ticker at runtime
  - [ ] File: `Scripts/Setup/Data/EventHeadlineData.cs` (new)
- [ ] Task 8: Add signal UI elements to UISetup (AC: 1, 5, 7)
  - [ ] Generate NewsTicker in bottom bar
  - [ ] Generate banner overlay area above chart
  - [ ] Generate ScreenEffects overlay
  - [ ] File: `Scripts/Setup/UISetup.cs` (extend)

## Dev Notes

### Architecture Compliance

- **Location:** UI signal components in `Scripts/Runtime/UI/`
- **NewsTicker.cs** per architecture project structure
- **EventBus subscription:** All visual signals driven by `MarketEventFiredEvent` — signals don't poll
- **One-way read:** Signal components read event data, never modify game state
- **Setup Framework:** All UI elements generated by UISetup.cs
- **Data:** Event headlines in `Scripts/Setup/Data/`

### GDD Signal Reference (Section 3.4)

| Event | Signal | Visual |
|-------|--------|--------|
| Earnings Beat | Green news banner flash | Banner slides down |
| Earnings Miss | Red news banner flash | Banner slides down |
| Pump & Dump | Suspicious volume spike | Sidebar icon pulse |
| SEC Investigation | Warning icon on stock | Yellow triangle |
| Sector Rotation | Sector highlight shift | Green/red sidebar glow |
| Merger Rumor | Rumor text crawl | News ticker |
| Market Crash | Screen shake + alarm | Shake + red vignette |
| Bull Run | Green tint on chart bg | Chart background color shift |
| Short Squeeze | Warning on short positions | Red exclamation in positions panel |
| Flash Crash | Rapid red flash | Brief red screen flash |

### Signal Timing — Immediate Response

All signals must appear the same frame the event fires. The flow:
1. EventScheduler fires event → publishes `MarketEventFiredEvent`
2. EventSignalManager receives event → dispatches to appropriate visual handler
3. Visual handler activates signal (banner, icon, shake) — all synchronous in the same frame
4. Signal duration controlled by timers within each visual component

### News Ticker Design

The ticker is a continuously scrolling horizontal text strip. New headlines are appended to the right side and scroll left. Multiple headlines can be visible simultaneously if events fire in quick succession.

```
║ ← MEME beats earnings expectations!  ← Flash crash hits YOLO!  ← Market  ║
```

### Screen Shake Implementation

For camera shake with uGUI, shake the root Canvas or a parent transform:

```csharp
// Simple shake: offset position randomly, decay over time
_shakeOffset = Random.insideUnitCircle * _shakeIntensity;
_shakeIntensity *= 0.9f; // Decay
transform.localPosition = _originalPosition + (Vector3)_shakeOffset;
```

### Project Structure Notes

- Creates: `Scripts/Runtime/UI/NewsTicker.cs`
- Creates: `Scripts/Runtime/UI/EventSignalManager.cs`
- Creates: `Scripts/Runtime/UI/ScreenEffects.cs`
- Creates: `Scripts/Setup/Data/EventHeadlineData.cs`
- Modifies: `Scripts/Runtime/UI/StockSidebar.cs` (add event indicator slots)
- Modifies: `Scripts/Setup/UISetup.cs`

### References

- [Source: game-architecture.md#Project Structure] — UI/NewsTicker.cs location
- [Source: game-architecture.md#Event System] — Subscribe to MarketEventFiredEvent
- [Source: game-architecture.md#Technical Requirements] — "Post-processing: Bloom, vignette, chromatic aberration via URP"
- [Source: bull-run-gdd-mvp.md#3.4] — Signal column in event type table
- [Source: bull-run-gdd-mvp.md#6.1] — "Bottom Bar: News ticker crawl showing incoming events"
- [Source: bull-run-gdd-mvp.md#6.2] — Juice: "Events should have immediate, satisfying feedback"
- [Source: bull-run-gdd-mvp.md#7.1] — "Neon green for gains, hot pink for losses"

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
