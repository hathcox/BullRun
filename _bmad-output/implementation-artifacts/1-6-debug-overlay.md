# Story 1.6: Debug Overlay

Status: ready-for-dev

## Story

As a developer,
I want a debug overlay (F1 toggle) showing trend direction, scheduled events, price tick probabilities, and win rate tracking,
so that I can tune balance during development.

## Acceptance Criteria

1. F1 key toggles the debug overlay on/off
2. Overlay shows the underlying trend direction (Bull/Bear/Neutral) for each active stock
3. Overlay shows trend strength (trendPerSecond value) per stock
4. Overlay shows current noise amplitude and reversion speed per stock
5. Overlay shows active events and their remaining duration on affected stocks
6. Overlay is wrapped in `#if UNITY_EDITOR || DEVELOPMENT_BUILD` — excluded from release builds
7. Overlay does not interfere with gameplay input or UI interaction

## Tasks / Subtasks

- [ ] Task 1: Create DebugManager MonoBehaviour (AC: 1, 6)
  - [ ] Wrap entire class in `#if UNITY_EDITOR || DEVELOPMENT_BUILD`
  - [ ] Handle F1 key press to toggle overlay visibility
  - [ ] Provide static `IsOverlayVisible` property for other debug components
  - [ ] File: `Scripts/Editor/DebugManager.cs`
- [ ] Task 2: Create DebugOverlayUI for price engine data (AC: 2, 3, 4, 5, 7)
  - [ ] Display per-stock debug info in a semi-transparent panel (top-right or configurable)
  - [ ] For each stock show: Ticker, Trend Direction (with arrow icon or color), TrendPerSecond, NoiseAmplitude, ReversionSpeed
  - [ ] Show active event name + remaining seconds if event is active
  - [ ] Use simple `OnGUI()` or uGUI text — this is a debug tool, not polished UI
  - [ ] Position overlay to not block the chart area
  - [ ] File: `Scripts/Editor/DebugOverlayUI.cs` (or add to DebugManager)
- [ ] Task 3: Expose PriceEngine debug data (AC: 2, 3, 4, 5)
  - [ ] Add public read accessors on PriceGenerator for current stock states
  - [ ] Method: `GetDebugInfo()` returns list of per-stock debug data structs
  - [ ] Includes: ticker, trend direction, trend strength, noise amplitude, reversion speed, active event info
  - [ ] File: `Scripts/Runtime/PriceEngine/PriceGenerator.cs` (extend)
- [ ] Task 4: Add DebugManager to Setup pipeline (AC: 1)
  - [ ] Create setup class that generates DebugManager GameObject in the scene
  - [ ] Only generate in editor/dev builds
  - [ ] File: `Scripts/Setup/DebugSetup.cs` (new, `[SetupClass(SetupPhase.SceneComposition)]`)
- [ ] Task 5: Reserve F2-F4 key slots (AC: 6)
  - [ ] Add placeholder key handlers in DebugManager for future debug tools
  - [ ] F2: God mode (not implemented yet — log "God mode not yet implemented")
  - [ ] F3: Skip to round (not implemented yet)
  - [ ] F4: Event trigger (not implemented yet)

## Dev Notes

### Architecture Compliance

- **Location:** Debug tools in `Scripts/Editor/` per architecture doc
- **Debug key mapping:** F1=overlay, F2=god mode, F3=skip round, F4=event trigger (per architecture Debug Tools table)
- **Conditional compilation:** ALL debug code wrapped in `#if UNITY_EDITOR || DEVELOPMENT_BUILD`
- **Setup Framework:** DebugManager is generated by a setup class, not manually placed in scene
- **Read-only access:** DebugOverlay reads from PriceEngine — never writes to it

### Architecture Debug Tools Reference

| Tool | Key | Purpose |
|------|-----|---------|
| Debug overlay | F1 | Price trends, scheduled events, win rate, economy stats |
| God mode | F2 | Infinite cash, can't fail margin call |
| Skip to round | F3 | Jump to any act/round with configurable starting cash |
| Event trigger | F4 | Force-fire any event type on any stock |

This story implements F1 only. F2-F4 are future stories (Epic 4 and Epic 5 will use them).

### Implementation Guidance

For the overlay display, `OnGUI` with `GUILayout` is the fastest approach for debug tools — no need for uGUI Canvas elements. Keep it simple:

```csharp
#if UNITY_EDITOR || DEVELOPMENT_BUILD
void OnGUI()
{
    if (!_isVisible) return;

    GUILayout.BeginArea(new Rect(Screen.width - 320, 10, 310, Screen.height - 20));
    GUILayout.Label("=== PRICE ENGINE DEBUG ===", _headerStyle);

    foreach (var stock in _priceGenerator.GetDebugInfo())
    {
        GUILayout.Label($"{stock.Ticker} | {stock.TrendDirection} | Trend: {stock.TrendPerSecond:F3}/s");
        GUILayout.Label($"  Noise: {stock.NoiseAmplitude:F3} | Reversion: {stock.ReversionSpeed:F3}");
        if (stock.HasActiveEvent)
            GUILayout.Label($"  EVENT: {stock.ActiveEventType} ({stock.EventTimeRemaining:F1}s)");
    }

    GUILayout.EndArea();
}
#endif
```

### Note on Win Rate Tracking

The GDD mentions win rate tracking in the debug overlay, but this requires meta-progression and run tracking (Epic 9). For now, implement the Price Engine portion. Win rate display will be added when the meta system exists.

### Project Structure Notes

- Creates: `Scripts/Editor/DebugManager.cs`
- Creates: `Scripts/Editor/DebugOverlayUI.cs` (or combined into DebugManager)
- Creates: `Scripts/Setup/DebugSetup.cs`
- Modifies: `Scripts/Runtime/PriceEngine/PriceGenerator.cs` (add GetDebugInfo method)

### References

- [Source: game-architecture.md#Debug Tools] — F1-F4 key mapping and purpose table
- [Source: game-architecture.md#Debug Tools] — "All wrapped in #if UNITY_EDITOR || DEVELOPMENT_BUILD"
- [Source: game-architecture.md#Debug Tools] — "Single DebugManager MonoBehaviour generated by setup code"
- [Source: game-architecture.md#Consistency Rules] — "New debug tool: Add to DebugManager.cs, #if conditional"
- [Source: bull-run-gdd-mvp.md#11.3] — "Implement a debug overlay (toggled with F1) that shows: the underlying trend direction..."

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
