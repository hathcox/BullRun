# Story 3.3: Stock Selection Sidebar

Status: ready-for-dev

## Story

As a player,
I want to switch between 3-4 stocks using a sidebar,
so that I can monitor and trade multiple instruments.

## Acceptance Criteria

1. Left sidebar lists all available stocks for the current round vertically
2. Each entry shows: ticker symbol, current price, % change since round start, mini-sparkline
3. Clicking/selecting a stock switches the main chart to display that stock
4. Number keys 1-4 select stocks by position in the list (keyboard shortcut)
5. Currently selected stock is visually highlighted
6. All stock entries update in real-time as prices change

## Tasks / Subtasks

- [ ] Task 1: Create StockSidebar MonoBehaviour (AC: 1, 6)
  - [ ] Subscribe to `PriceUpdatedEvent` to update stock entries in real-time
  - [ ] Populate entries at round start from PriceGenerator's active stocks
  - [ ] Method: `InitializeForRound(List<StockInstance> stocks)` — builds the sidebar
  - [ ] File: `Scripts/Runtime/UI/StockSidebar.cs`
- [ ] Task 2: Build stock entry UI elements (AC: 2)
  - [ ] Per-entry layout: ticker (bold, left), current price (right-aligned, monospace), % change (colored), mini-sparkline
  - [ ] Use TextMeshPro for text, small LineRenderer or UI graphic for sparkline
  - [ ] Sparkline: last ~20 price points as a tiny line graph (width of entry)
  - [ ] File: `Scripts/Runtime/UI/StockSidebar.cs`
- [ ] Task 3: Implement stock selection (AC: 3, 5)
  - [ ] On click/select: publish `StockSelectedEvent` with the selected stock ID
  - [ ] ChartRenderer (Story 3.1) subscribes to `StockSelectedEvent` and calls `SetActiveStock()`
  - [ ] Highlight selected entry: brighter background, border glow, or color accent
  - [ ] Default: first stock selected at round start
  - [ ] File: `Scripts/Runtime/UI/StockSidebar.cs`
- [ ] Task 4: Implement keyboard shortcuts (AC: 4)
  - [ ] Number keys 1-4 select corresponding stock by list position
  - [ ] Use Unity Input System action map for stock selection
  - [ ] Keys map to sidebar index, not stock ID (so key 1 = first stock regardless of ticker)
  - [ ] File: `Scripts/Runtime/UI/StockSidebar.cs`
- [ ] Task 5: Define StockSelectedEvent (AC: 3)
  - [ ] `StockSelectedEvent`: StockId, TickerSymbol
  - [ ] Add to `Scripts/Runtime/Core/GameEvents.cs`
- [ ] Task 6: Add sidebar to UISetup (AC: 1)
  - [ ] Generate sidebar Canvas elements on left side of screen
  - [ ] Vertical layout group for stock entries
  - [ ] Position does not overlap chart area
  - [ ] File: `Scripts/Setup/UISetup.cs` (extend)

## Dev Notes

### Architecture Compliance

- **Location:** `Scripts/Runtime/UI/StockSidebar.cs` per architecture project structure
- **EventBus:** Publishes `StockSelectedEvent`, subscribes to `PriceUpdatedEvent`
- **One-way read:** Reads stock data from PriceGenerator's public accessors or StockInstance data
- **Input System:** Use Unity Input System action maps, not legacy Input.GetKeyDown
- **Setup Framework:** Sidebar UI generated by UISetup.cs

### Mini-Sparkline Implementation

The sparkline is a tiny chart showing recent price history. Options:
1. **UI LineRenderer** (simplest) — a small LineRenderer component per entry, 20 points
2. **Procedural UI Image** — draw onto a RawImage texture
3. **UI Graphic override** — custom Graphic that draws line segments

Recommend option 1 for simplicity. Each sparkline tracks a rolling buffer of the last ~20 price updates for that stock.

### % Change Color Coding

- Positive: neon green (matches chart line color)
- Negative: hot pink/red (matches loss color from GDD)
- Zero/flat: white or dim gray

### Screen Layout Reference

```
┌─────────────────────────────────────────────────┐
│ [Top Bar - TradingHUD]                           │
├──────────┬────────────────────────┬──────────────┤
│          │                        │              │
│ SIDEBAR  │      CHART             │  Positions   │
│          │                        │              │
│ [1] MEME │                        │              │
│ $2.34 +5%│                        │              │
│ ~~~~~~~~ │                        │              │
│          │                        │              │
│ [2] YOLO │                        │              │
│ $0.87 -3%│                        │              │
│ ~~~~~~~~ │                        │              │
│          │                        │              │
├──────────┴────────────────────────┴──────────────┤
│ [Bottom Bar]                                      │
└─────────────────────────────────────────────────┘
```

### Project Structure Notes

- Creates: `Scripts/Runtime/UI/StockSidebar.cs`
- Modifies: `Scripts/Runtime/Core/GameEvents.cs` (add StockSelectedEvent)
- Modifies: `Scripts/Setup/UISetup.cs` (add sidebar generation)
- Depends on: ChartRenderer.SetActiveStock() (Story 3.1)
- Depends on: PriceUpdatedEvent (Epic 1)

### References

- [Source: game-architecture.md#Project Structure] — UI/StockSidebar.cs location
- [Source: game-architecture.md#Engine-Provided Architecture] — Unity Input System for action maps
- [Source: game-architecture.md#Why uGUI Over UI Toolkit] — Canvas for dense HUD layouts
- [Source: bull-run-gdd-mvp.md#6.1] — "Left Sidebar: Available stocks vertically. Each shows: ticker symbol, current price, % change, mini-sparkline"
- [Source: bull-run-gdd-mvp.md#6.3] — "Cycle Stocks: Number keys 1-4 / Mouse click sidebar / D-Pad Left/Right"

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
