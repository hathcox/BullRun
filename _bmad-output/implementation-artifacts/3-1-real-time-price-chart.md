# Story 3.1: Real-Time Price Chart

Status: ready-for-dev

## Story

As a player,
I want to see a price line drawing itself in real-time across the screen,
so that I can observe and react to price movement.

## Acceptance Criteria

1. A line chart draws left-to-right during the trading phase, showing the selected stock's price over time
2. The current price is shown at the chart head with a glowing indicator
3. Price axis (Y-axis) is displayed on the right side with auto-scaling labels
4. Time remaining is shown as a progress bar along the bottom of the chart
5. Chart occupies ~60% center of screen per GDD layout spec
6. Maintains 60fps with animations
7. Chart clears and resets at the start of each new round

## Tasks / Subtasks

- [ ] Task 1: Create ChartRenderer with LineRenderer (AC: 1, 6)
  - [ ] Use Unity LineRenderer component to draw the price line
  - [ ] Feed new price points each frame from PriceUpdatedEvent subscription
  - [ ] Points added left-to-right based on elapsed time vs round duration
  - [ ] X-axis maps to time (0 = round start, 1 = round end), Y-axis maps to price
  - [ ] Configure LineRenderer: width, material, color (neon green per art direction)
  - [ ] File: `Scripts/Runtime/Chart/ChartRenderer.cs`
- [ ] Task 2: Add glow trail effect (AC: 2)
  - [ ] Second LineRenderer behind the main line with wider width and lower opacity
  - [ ] Creates a bloom/glow appearance on the line head
  - [ ] Current price indicator: bright dot or enlarged point at the line head
  - [ ] Use URP bloom post-processing to enhance the glow effect
  - [ ] File: `Scripts/Runtime/Chart/ChartRenderer.cs` (same file)
- [ ] Task 3: Create ChartUI for price axis and time bar (AC: 3, 4)
  - [ ] Y-axis labels on right side: auto-scale to current price range (min/max visible)
  - [ ] Update axis labels as price range expands during the round
  - [ ] Time progress bar along chart bottom: fills left-to-right as round progresses
  - [ ] Use uGUI Text/TMP for labels, uGUI Image for progress bar
  - [ ] File: `Scripts/Runtime/Chart/ChartUI.cs`
- [ ] Task 4: Create ChartSetup to generate chart objects (AC: 5)
  - [ ] Generate chart parent GameObject with LineRenderer components
  - [ ] Generate chart UI Canvas elements (axis labels, time bar)
  - [ ] Position chart in center ~60% of screen
  - [ ] Attribute: `[SetupClass(SetupPhase.SceneComposition)]`
  - [ ] File: `Scripts/Setup/ChartSetup.cs`
- [ ] Task 5: Subscribe to PriceUpdatedEvent (AC: 1, 7)
  - [ ] ChartRenderer subscribes to `PriceUpdatedEvent`
  - [ ] Only processes events for the currently displayed stock
  - [ ] Method: `SetActiveStock(string stockId)` — switches which stock the chart displays
  - [ ] Method: `ResetChart()` — clears all points for new round
  - [ ] File: `Scripts/Runtime/Chart/ChartRenderer.cs` (extend)
- [ ] Task 6: Performance validation (AC: 6)
  - [ ] Profile LineRenderer with 60 seconds of price data (~3600 points at 60fps)
  - [ ] If point count causes frame drops, implement point decimation (keep every Nth point for older data)
  - [ ] Ensure glow trail doesn't double the performance cost

## Dev Notes

### Architecture Compliance

- **Location:** Chart code in `Scripts/Runtime/Chart/` — `ChartRenderer.cs` and `ChartUI.cs`
- **Setup Framework:** Chart objects generated by `Scripts/Setup/ChartSetup.cs` with `[SetupClass]` attribute
- **EventBus:** Subscribe to `PriceUpdatedEvent` — never call PriceEngine directly
- **Rendering approach:** LineRenderer (prototype) per architecture decision. Swap to custom triangle-strip mesh + URP shader if visual quality or performance demands it.
- **uGUI:** Canvas hierarchy created programmatically per Setup-Oriented framework. No Inspector configuration.

### Architecture Chart Rendering Decision

> "LineRenderer fed price points each frame. Second LineRenderer for glow trail. Volume bars as simple UI rects below chart. Swap to custom triangle-strip mesh + URP shader if visual quality or performance demands it."

Start with LineRenderer — it gets the core loop playable fast. The swap to custom mesh is just a code change + F5.

### Performance Budget

At 60fps over 60 seconds = 3,600 points maximum. LineRenderer handles this well for a single line. Two LineRenderers (main + glow) doubles it to ~7,200 vertices — still fine. If profiling shows issues:
1. Decimate older points (keep every 3rd point for data older than 10 seconds)
2. Switch to custom mesh with LOD

### Chart Layout (GDD Section 6.1)

```
┌─────────────────────────────────────────────────┐
│ [Top Bar - HUD - Story 3.2]                      │
├──────┬──────────────────────────────┬────────────┤
│      │                              │            │
│ Left │    CENTER: PRICE CHART       │   Right    │
│ Side │    (~60% of screen)          │   Side     │
│ bar  │    LineRenderer draws here   │   bar      │
│      │                              │            │
│ 3.3  │    [Price axis on right →]   │   3.4      │
│      │    [Time bar on bottom]      │            │
├──────┴──────────────────────────────┴────────────┤
│ [Bottom Bar - Tools/News]                         │
└─────────────────────────────────────────────────┘
```

### Color Palette (GDD Section 7.1)

- Chart line: neon green (#00FF88 or similar synthwave green)
- Glow trail: same color at ~30% opacity, wider width
- Background: dark navy (#0A0E27 or similar)
- Price axis labels: white or light gray
- Time progress bar: subtle, doesn't compete with chart

### Project Structure Notes

- Creates: `Scripts/Runtime/Chart/ChartRenderer.cs`
- Creates: `Scripts/Runtime/Chart/ChartUI.cs`
- Creates: `Scripts/Setup/ChartSetup.cs`
- Depends on: `Scripts/Runtime/Core/EventBus.cs` (from Epic 1)
- Depends on: `PriceUpdatedEvent` (from Epic 1)

### References

- [Source: game-architecture.md#Chart Rendering] — LineRenderer approach, glow trail, volume bars
- [Source: game-architecture.md#Project Structure] — Chart/ folder: ChartRenderer, ChartUI
- [Source: game-architecture.md#Technical Risks] — "Chart rendering performance: Profile in week 2"
- [Source: game-architecture.md#Setup-Oriented Generation Framework] — Setup class pattern
- [Source: bull-run-gdd-mvp.md#6.1] — Screen layout: center 60%, price axis right, time bar bottom
- [Source: bull-run-gdd-mvp.md#7.1] — Synthwave aesthetic: neon green, dark navy
- [Source: bull-run-gdd-mvp.md#8.4] — "Chart Performance: Rendering smooth real-time line chart at 60fps"

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
